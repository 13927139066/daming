
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/panel/Sign.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '126e8CHwslF0K3MAeMYYnht', 'Sign');
// Script/panel/Sign.js

"use strict";

var GameConfig = require("GameConfig");
var GameTools = require("GameTools");
var GameUiTools = require("GameUiTools");
cc.Class({
  "extends": cc.Component,
  properties: {
    signbg: {
      "default": [],
      type: cc.Sprite,
      displayName: "签到背景图片"
    },
    choose: {
      "default": [],
      type: cc.Node,
      displayName: "勾"
    },
    signBtn: {
      "default": null,
      type: cc.Node,
      displayName: "签到按钮"
    },
    doubleSignBtn: {
      "default": null,
      type: cc.Node,
      displayName: "双倍领取"
    }
  },
  onLoad: function onLoad() {
    // GameTools.setItemByLocalStorage("checkInTimestamp",0);
    // GameTools.setItemByLocalStorage("checkInDays",0);
    if (!GameConfig.IS_GAME_SHARE) {
      this.doubleSignBtn.active = false;
      this.signBtn.setPosition(0, -488);
    }
    if (this.hasCheckedToday()) {
      // GameTools.showToast('已签到');
      this.signBtn.color = new cc.Color(125, 125, 125);
      this.signBtn.removeComponent(cc.Button);
      this.doubleSignBtn.color = new cc.Color(125, 125, 125);
      this.doubleSignBtn.removeComponent(cc.Button);
    }

    // this.isClick = false;
    window.cp = this;
    this.SignDay = GameTools.getItemByLocalStorage('checkInDays', 0);
    this.day = this.SignDay % 7;
    var hasChecked = this.hasCheckedToday();
    for (var i = 0; i < 7; i++) {
      if (i < this.day || this.day === 0 && hasChecked) {
        this.choose[i].active = true;
        GameUiTools.setSpriteFrame("sign/bb2", this.signbg[i]);
      } else if (i === this.day && hasChecked) {
        this.choose[i].active = false;
        // this.takens[i].opacity = 0;
      } else {
        this.choose[i].active = false;
        // this.takens[i].opacity = 0;
      }
    }
  },
  //判断今天是否签到
  hasCheckedToday: function hasCheckedToday() {
    console.log("判断今天是否签到");
    var lastCheckInTimestamp = GameTools.getItemByLocalStorage("checkInTimestamp", 0);
    var now = new Date();
    var todayBeginTimestamp = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
    return lastCheckInTimestamp >= todayBeginTimestamp; //真为已签到，假没签到
  },

  close: function close() {
    GameTools.playSimpleAudioEngine(3);
    this.node.destroy();
  },
  disableBtn: function disableBtn(day) {
    // window.cp.takens[day].opacity = 255;
    window.cp.choose[day].active = true;
    GameUiTools.setSpriteFrame("sign/bb2", window.cp.signbg[day]);
    window.cp.doubleSignBtn.color = new cc.Color(125, 125, 125);
    window.cp.doubleSignBtn.removeComponent(cc.Button);
    window.cp.signBtn.color = new cc.Color(125, 125, 125);
    window.cp.signBtn.removeComponent(cc.Button);
  },
  doubleSign: function doubleSign() {
    GameTools.playSimpleAudioEngine(3);
    // this.isClick = true;
    var coins = [4000, 200, 8000, 400, 16000, 800, 30000];
    if (this.hasCheckedToday()) {
      console.log("已经签到");
      GameTools.showDialog('已经签到');
      return;
    }
    if (cc.sys.platform === cc.sys.WECHAT_GAME) {
      // wx.aldSendEvent('看视频双倍签到',{'key' : 'value'});
      GameTools._createVedioAd(function (res) {
        if (res.isEnded || res.raw) {
          if (window.cp.day % 2 != 0) {
            GameConfig.GameCoin += coins[window.cp.day];
            GameTools.showToast("获得元宝+" + coins[window.cp.day]);
            GameTools.setItemByLocalStorage("GameCoin", GameConfig.GameCoin);
          } else {
            GameConfig.GameMoney += coins[window.cp.day];
            GameTools.showToast("获得铜钱+" + coins[window.cp.day]);
            GameTools.setItemByLocalStorage("GameMoney", GameConfig.GameMoney);
          }
          window.cp.disableBtn(window.cp.day); //按钮的判断
          GameTools.setItemByLocalStorage("checkInDays", window.cp.SignDay + 1);
          GameTools.setItemByLocalStorage("checkInTimestamp", Date.now());
        }
      });
    } else if (cc.sys.platform === cc.sys.BYTEDANCE_GAME) {
      tt.showModal({
        title: "是否观看广告双倍领取",
        confirmColor: "#050511",
        cancelColor: "#FF0000",
        success: function success(res) {
          console.log("用户点击了" + (res.confirm ? "确定" : "取消"));
          if (res.confirm) {
            GameTools._createVedioAd(function (res) {
              if (res.isEnded || res.raw) {
                if (window.cp.day % 2 != 0) {
                  GameConfig.GameCoin += coins[window.cp.day];
                  GameTools.showToast("获得元宝+" + coins[window.cp.day]);
                  GameTools.setItemByLocalStorage("GameCoin", GameConfig.GameCoin);
                } else {
                  GameConfig.GameMoney += coins[window.cp.day];
                  GameTools.showToast("获得铜钱+" + coins[window.cp.day]);
                  GameTools.setItemByLocalStorage("GameMoney", GameConfig.GameMoney);
                }
                window.cp.disableBtn(window.cp.day); //按钮的判断
                GameTools.setItemByLocalStorage("checkInDays", window.cp.SignDay + 1);
                GameTools.setItemByLocalStorage("checkInTimestamp", Date.now());
              }
            });
          }
          if (res.cancel) {
            tt.showToast({
              title: '取消观看广告',
              icon: "none"
            });
          }
        },
        fail: function fail(err) {
          console.log('showModal fail', err);
        },
        complete: function complete(res) {
          console.log('showModal complete', res);
        }
      });
    }
  },
  sign: function sign() {
    GameTools.playSimpleAudioEngine(3);
    var coins = [2000, 100, 4000, 200, 8000, 400, 15000];
    if (this.hasCheckedToday()) {
      console.log("已经签到");
      GameTools.showDialog('已经签到');
      return;
    }
    if (this.day % 2 != 0) {
      GameConfig.GameCoin += coins[this.day];
      GameTools.showToast("获得元宝+" + coins[this.day]);
      GameTools.setItemByLocalStorage("GameCoin", GameConfig.GameCoin);
    } else {
      GameConfig.GameMoney += coins[this.day];
      GameTools.showToast("获得铜钱+" + coins[this.day]);
      GameTools.setItemByLocalStorage("GameMoney", GameConfig.GameMoney);
    }
    window.cp.disableBtn(this.day); //按钮的判断
    GameTools.setItemByLocalStorage("checkInDays", this.SignDay + 1);
    GameTools.setItemByLocalStorage("checkInTimestamp", Date.now());
    // GameData.setSignDay(GameData.getSignDay()+1);
    // GameData.setCheckInTimestamp(Date.now());
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxwYW5lbFxcU2lnbi5qcyJdLCJuYW1lcyI6WyJHYW1lQ29uZmlnIiwicmVxdWlyZSIsIkdhbWVUb29scyIsIkdhbWVVaVRvb2xzIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJzaWduYmciLCJ0eXBlIiwiU3ByaXRlIiwiZGlzcGxheU5hbWUiLCJjaG9vc2UiLCJOb2RlIiwic2lnbkJ0biIsImRvdWJsZVNpZ25CdG4iLCJvbkxvYWQiLCJJU19HQU1FX1NIQVJFIiwiYWN0aXZlIiwic2V0UG9zaXRpb24iLCJoYXNDaGVja2VkVG9kYXkiLCJjb2xvciIsIkNvbG9yIiwicmVtb3ZlQ29tcG9uZW50IiwiQnV0dG9uIiwid2luZG93IiwiY3AiLCJTaWduRGF5IiwiZ2V0SXRlbUJ5TG9jYWxTdG9yYWdlIiwiZGF5IiwiaGFzQ2hlY2tlZCIsImkiLCJzZXRTcHJpdGVGcmFtZSIsImNvbnNvbGUiLCJsb2ciLCJsYXN0Q2hlY2tJblRpbWVzdGFtcCIsIm5vdyIsIkRhdGUiLCJ0b2RheUJlZ2luVGltZXN0YW1wIiwiZ2V0RnVsbFllYXIiLCJnZXRNb250aCIsImdldERhdGUiLCJnZXRUaW1lIiwiY2xvc2UiLCJwbGF5U2ltcGxlQXVkaW9FbmdpbmUiLCJub2RlIiwiZGVzdHJveSIsImRpc2FibGVCdG4iLCJkb3VibGVTaWduIiwiY29pbnMiLCJzaG93RGlhbG9nIiwic3lzIiwicGxhdGZvcm0iLCJXRUNIQVRfR0FNRSIsIl9jcmVhdGVWZWRpb0FkIiwicmVzIiwiaXNFbmRlZCIsInJhdyIsIkdhbWVDb2luIiwic2hvd1RvYXN0Iiwic2V0SXRlbUJ5TG9jYWxTdG9yYWdlIiwiR2FtZU1vbmV5IiwiQllURURBTkNFX0dBTUUiLCJ0dCIsInNob3dNb2RhbCIsInRpdGxlIiwiY29uZmlybUNvbG9yIiwiY2FuY2VsQ29sb3IiLCJzdWNjZXNzIiwiY29uZmlybSIsImNhbmNlbCIsImljb24iLCJmYWlsIiwiZXJyIiwiY29t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QUFDeUQsU0FBUyxDQUFDLE9BQU8sR0FBR1YsS0FBSyxDQUFDLElBQUksQ0FBQ3BCLEdBQUcsQ0FBQyxDQUFDO01BQzlDM0IsU0FBUyxDQUFDMEQscUJBQXFCLENBQUMsVUFBVSxFQUFDNUQsVUFBVSxDQUFDMEQsUUFBUSxDQUFDO0lBQ25FLENBQUMsTUFBSTtNQUNEMUQsVUFBVSxDQUFDNkQsU0FBUyxJQUFJWixLQUFLLENBQUMsSUFBSSxDQUFDcEIsR0FBRyxDQUFDO01BQ3ZDM0IsU0FBUyxDQUFDeUQsU0FBUyxDQUFDLE9BQU8sR0FBR1YsS0FBSyxDQUFDLElBQUksQ0FBQ3BCLEdBQUcsQ0FBQyxDQUFDO01BQzlDM0IsU0FBUyxDQUFDMEQscUJBQXFCLENBQUMsV0FBVyxFQUFDNUQsVUFBVSxDQUFDNkQsU0FBUyxDQUFDO0lBQ3JFO0lBRUFwQyxNQUFNLENBQUNDLEVBQUUsQ0FBQ3FCLFVBQVUsQ0FBQyxJQUFJLENBQUNsQixHQUFHLENBQUMsQ0FBQztJQUMvQjNCLFNBQVMsQ0FBQzBELHFCQUFxQixDQUFDLGFBQWEsRUFBQyxJQUFJLENBQUNqQyxPQUFPLEdBQUMsQ0FBQyxDQUFDO0lBQzdEekIsU0FBUyxDQUFDMEQscUJBQXFCLENBQUMsa0JBQWtCLEVBQUN2QixJQUFJLENBQUNELEdBQUcsRUFBRSxDQUFDO0lBQzlEO0lBQ0E7RUFDSjtBQUNKLENBQUMsQ0FBQyIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyIEdhbWVDb25maWcgPSByZXF1aXJlKFwiR2FtZUNvbmZpZ1wiKTtcbnZhciBHYW1lVG9vbHMgPSByZXF1aXJlKFwiR2FtZVRvb2xzXCIpO1xudmFyIEdhbWVVaVRvb2xzID0gcmVxdWlyZShcIkdhbWVVaVRvb2xzXCIpO1xuY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcblxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgc2lnbmJnOntcbiAgICAgICAgICAgIGRlZmF1bHQ6W10sXG4gICAgICAgICAgICB0eXBlOmNjLlNwcml0ZSxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOlwi562+5Yiw6IOM5pmv5Zu+54mHXCJcbiAgICAgICAgfSxcbiAgICAgICAgY2hvb3NlOntcbiAgICAgICAgICAgIGRlZmF1bHQ6W10sXG4gICAgICAgICAgICB0eXBlOmNjLk5vZGUsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTpcIuWLvlwiXG4gICAgICAgIH0sXG4gICAgICAgIHNpZ25CdG46e1xuICAgICAgICAgICAgZGVmYXVsdDpudWxsLFxuICAgICAgICAgICAgdHlwZTpjYy5Ob2RlLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6XCLnrb7liLDmjInpkq5cIlxuICAgICAgICB9LFxuICAgICAgICBkb3VibGVTaWduQnRuOntcbiAgICAgICAgICAgIGRlZmF1bHQ6bnVsbCxcbiAgICAgICAgICAgIHR5cGU6Y2MuTm9kZSxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOlwi5Y+M5YCN6aKG5Y+WXCJcbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25Mb2FkKCkge1xuICAgICAgICAvLyBHYW1lVG9vbHMuc2V0SXRlbUJ5TG9jYWxTdG9yYWdlKFwiY2hlY2tJblRpbWVzdGFtcFwiLDApO1xuICAgICAgICAvLyBHYW1lVG9vbHMuc2V0SXRlbUJ5TG9jYWxTdG9yYWdlKFwiY2hlY2tJbkRheXNcIiwwKTtcbiAgICAgICAgaWYoIUdhbWVDb25maWcuSVNfR0FNRV9TSEFSRSl7XG4gICAgICAgICAgICB0aGlzLmRvdWJsZVNpZ25CdG4uYWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnNpZ25CdG4uc2V0UG9zaXRpb24oMCwtNDg4KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5oYXNDaGVja2VkVG9kYXkoKSkge1xuICAgICAgICAgICAgLy8gR2FtZVRvb2xzLnNob3dUb2FzdCgn5bey562+5YiwJyk7XG4gICAgICAgICAgICB0aGlzLnNpZ25CdG4uY29sb3IgPSBuZXcgY2MuQ29sb3IoMTI1LCAxMjUsIDEyNSk7XG4gICAgICAgICAgICB0aGlzLnNpZ25CdG4ucmVtb3ZlQ29tcG9uZW50KGNjLkJ1dHRvbik7XG4gICAgICAgICAgICB0aGlzLmRvdWJsZVNpZ25CdG4uY29sb3IgPSBuZXcgY2MuQ29sb3IoMTI1LCAxMjUsIDEyNSk7XG4gICAgICAgICAgICB0aGlzLmRvdWJsZVNpZ25CdG4ucmVtb3ZlQ29tcG9uZW50KGNjLkJ1dHRvbik7XG4gICAgICAgIH1cblxuICAgICAgICAvLyB0aGlzLmlzQ2xpY2sgPSBmYWxzZTtcbiAgICAgICAgd2luZG93LmNwID0gdGhpcztcbiAgICAgICAgdGhpcy5TaWduRGF5ID0gR2FtZVRvb2xzLmdldEl0ZW1CeUxvY2FsU3RvcmFnZSgnY2hlY2tJbkRheXMnLDApO1xuICAgICAgICB0aGlzLmRheSA9IHRoaXMuU2lnbkRheSAlIDc7XG4gICAgICAgIGxldCBoYXNDaGVja2VkID0gdGhpcy5oYXNDaGVja2VkVG9kYXkoKTtcbiAgICAgICAgZm9yKGxldCBpID0gMDtpPDc7aSsrKXtcbiAgICAgICAgICAgIGlmKGk8dGhpcy5kYXkgfHwgKHRoaXMuZGF5ID09PSAwICYmIGhhc0NoZWNrZWQpKXtcbiAgICAgICAgICAgICAgICB0aGlzLmNob29zZVtpXS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIEdhbWVVaVRvb2xzLnNldFNwcml0ZUZyYW1lKFwic2lnbi9iYjJcIix0aGlzLnNpZ25iZ1tpXSk7XG4gICAgICAgICAgICB9ZWxzZSBpZihpID09PSB0aGlzLmRheSAmJiBoYXNDaGVja2VkKXtcbiAgICAgICAgICAgICAgICB0aGlzLmNob29zZVtpXS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAvLyB0aGlzLnRha2Vuc1tpXS5vcGFjaXR5ID0gMDtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHRoaXMuY2hvb3NlW2ldLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIC8vIHRoaXMudGFrZW5zW2ldLm9wYWNpdHkgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcbiAgICAvL+WIpOaWreS7iuWkqeaYr+WQpuetvuWIsFxuICAgIGhhc0NoZWNrZWRUb2RheSgpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCLliKTmlq3ku4rlpKnmmK/lkKbnrb7liLBcIilcbiAgICAgICAgbGV0IGxhc3RDaGVja0luVGltZXN0YW1wID0gR2FtZVRvb2xzLmdldEl0ZW1CeUxvY2FsU3RvcmFnZShcImNoZWNrSW5UaW1lc3RhbXBcIiwwKTtcbiAgICAgICAgbGV0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGxldCB0b2RheUJlZ2luVGltZXN0YW1wID0gbmV3IERhdGUobm93LmdldEZ1bGxZZWFyKCksIG5vdy5nZXRNb250aCgpLCBub3cuZ2V0RGF0ZSgpKS5nZXRUaW1lKCk7XG4gICAgICAgIHJldHVybiBsYXN0Q2hlY2tJblRpbWVzdGFtcCA+PSB0b2RheUJlZ2luVGltZXN0YW1wOy8v55yf5Li65bey562+5Yiw77yM5YGH5rKh562+5YiwXG4gICAgfSxcblxuICAgIGNsb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIEdhbWVUb29scy5wbGF5U2ltcGxlQXVkaW9FbmdpbmUoMyk7XG4gICAgICAgIHRoaXMubm9kZS5kZXN0cm95KCk7XG4gICAgfSxcblxuICAgIGRpc2FibGVCdG46IGZ1bmN0aW9uIChkYXkpIHtcbiAgICAgICAgLy8gd2luZG93LmNwLnRha2Vuc1tkYXldLm9wYWNpdHkgPSAyNTU7XG4gICAgICAgIHdpbmRvdy5jcC5jaG9vc2VbZGF5XS5hY3RpdmUgPSB0cnVlO1xuICAgICAgICBHYW1lVWlUb29scy5zZXRTcHJpdGVGcmFtZShcInNpZ24vYmIyXCIsd2luZG93LmNwLnNpZ25iZ1tkYXldKTtcbiAgICAgICAgd2luZG93LmNwLmRvdWJsZVNpZ25CdG4uY29sb3IgPSBuZXcgY2MuQ29sb3IoMTI1LCAxMjUsIDEyNSk7XG4gICAgICAgIHdpbmRvdy5jcC5kb3VibGVTaWduQnRuLnJlbW92ZUNvbXBvbmVudChjYy5CdXR0b24pO1xuICAgICAgICB3aW5kb3cuY3Auc2lnbkJ0bi5jb2xvciA9IG5ldyBjYy5Db2xvcigxMjUsIDEyNSwgMTI1KTtcbiAgICAgICAgd2luZG93LmNwLnNpZ25CdG4ucmVtb3ZlQ29tcG9uZW50KGNjLkJ1dHRvbik7XG4gICAgfSxcbiAgICBkb3VibGVTaWduOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIEdhbWVUb29scy5wbGF5U2ltcGxlQXVkaW9FbmdpbmUoMyk7XG4gICAgICAgIC8vIHRoaXMuaXNDbGljayA9IHRydWU7XG4gICAgICAgIGxldCBjb2lucyA9IFs0MDAwLCAyMDAsIDgwMDAsIDQwMCwgMTYwMDAsIDgwMCwgMzAwMDBdO1xuICAgICAgICBpZiAodGhpcy5oYXNDaGVja2VkVG9kYXkoKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCLlt7Lnu4/nrb7liLBcIilcbiAgICAgICAgICAgIEdhbWVUb29scy5zaG93RGlhbG9nKCflt7Lnu4/nrb7liLAnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZihjYy5zeXMucGxhdGZvcm0gPT09IGNjLnN5cy5XRUNIQVRfR0FNRSl7XG4gICAgICAgICAgICAvLyB3eC5hbGRTZW5kRXZlbnQoJ+eci+inhumikeWPjOWAjeetvuWIsCcseydrZXknIDogJ3ZhbHVlJ30pO1xuICAgICAgICAgICAgR2FtZVRvb2xzLl9jcmVhdGVWZWRpb0FkKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzLmlzRW5kZWQgfHwgcmVzLnJhdykge1xuICAgICAgICAgICAgICAgICAgICBpZih3aW5kb3cuY3AuZGF5ICUgMiAhPSAwKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIEdhbWVDb25maWcuR2FtZUNvaW4gKz0gY29pbnNbd2luZG93LmNwLmRheV07XG4gICAgICAgICAgICAgICAgICAgICAgICBHYW1lVG9vbHMuc2hvd1RvYXN0KFwi6I635b6X5YWD5a6dK1wiICsgY29pbnNbd2luZG93LmNwLmRheV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgR2FtZVRvb2xzLnNldEl0ZW1CeUxvY2FsU3RvcmFnZShcIkdhbWVDb2luXCIsR2FtZUNvbmZpZy5HYW1lQ29pbik7XG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgR2FtZUNvbmZpZy5HYW1lTW9uZXkgKz0gY29pbnNbd2luZG93LmNwLmRheV07XG4gICAgICAgICAgICAgICAgICAgICAgICBHYW1lVG9vbHMuc2hvd1RvYXN0KFwi6I635b6X6ZOc6ZKxK1wiICsgY29pbnNbd2luZG93LmNwLmRheV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgR2FtZVRvb2xzLnNldEl0ZW1CeUxvY2FsU3RvcmFnZShcIkdhbWVNb25leVwiLEdhbWVDb25maWcuR2FtZU1vbmV5KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jcC5kaXNhYmxlQnRuKHdpbmRvdy5jcC5kYXkpOy8v5oyJ6ZKu55qE5Yik5patXG4gICAgICAgICAgICAgICAgICAgIEdhbWVUb29scy5zZXRJdGVtQnlMb2NhbFN0b3JhZ2UoXCJjaGVja0luRGF5c1wiLHdpbmRvdy5jcC5TaWduRGF5KzEpO1xuICAgICAgICAgICAgICAgICAgICBHYW1lVG9vbHMuc2V0SXRlbUJ5TG9jYWxTdG9yYWdlKFwiY2hlY2tJblRpbWVzdGFtcFwiLERhdGUubm93KCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9ZWxzZSBpZihjYy5zeXMucGxhdGZvcm0gPT09IGNjLnN5cy5CWVRFREFOQ0VfR0FNRSl7XG4gICAgICAgICAgICB0dC5zaG93TW9kYWwoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiBcIuaYr+WQpuingueci+W5v+WRiuWPjOWAjemihuWPllwiLFxuICAgICAgICAgICAgICAgIGNvbmZpcm1Db2xvcjogXCIjMDUwNTExXCIsXG4gICAgICAgICAgICAgICAgY2FuY2VsQ29sb3I6IFwiI0ZGMDAwMFwiLFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3MocmVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi55So5oi354K55Ye75LqGXCIgKyAocmVzLmNvbmZpcm0gPyBcIuehruWumlwiIDogXCLlj5bmtohcIikpXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXMuY29uZmlybSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgR2FtZVRvb2xzLl9jcmVhdGVWZWRpb0FkKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmlzRW5kZWQgfHwgcmVzLnJhdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih3aW5kb3cuY3AuZGF5ICUgMiAhPSAwKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdhbWVDb25maWcuR2FtZUNvaW4gKz0gY29pbnNbd2luZG93LmNwLmRheV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHYW1lVG9vbHMuc2hvd1RvYXN0KFwi6I635b6X5YWD5a6dK1wiICsgY29pbnNbd2luZG93LmNwLmRheV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR2FtZVRvb2xzLnNldEl0ZW1CeUxvY2FsU3RvcmFnZShcIkdhbWVDb2luXCIsR2FtZUNvbmZpZy5HYW1lQ29pbik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR2FtZUNvbmZpZy5HYW1lTW9uZXkgKz0gY29pbnNbd2luZG93LmNwLmRheV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHYW1lVG9vbHMuc2hvd1RvYXN0KFwi6I635b6X6ZOc6ZKxK1wiICsgY29pbnNbd2luZG93LmNwLmRheV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR2FtZVRvb2xzLnNldEl0ZW1CeUxvY2FsU3RvcmFnZShcIkdhbWVNb25leVwiLEdhbWVDb25maWcuR2FtZU1vbmV5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jcC5kaXNhYmxlQnRuKHdpbmRvdy5jcC5kYXkpOy8v5oyJ6ZKu55qE5Yik5patXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdhbWVUb29scy5zZXRJdGVtQnlMb2NhbFN0b3JhZ2UoXCJjaGVja0luRGF5c1wiLHdpbmRvdy5jcC5TaWduRGF5KzEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHYW1lVG9vbHMuc2V0SXRlbUJ5TG9jYWxTdG9yYWdlKFwiY2hlY2tJblRpbWVzdGFtcFwiLERhdGUubm93KCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXMuY2FuY2VsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0dC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAn5Y+W5raI6KeC55yL5bm/5ZGKJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uOiBcIm5vbmVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZhaWwoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzaG93TW9kYWwgZmFpbCcsIGVycik7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb21wbGV0ZShyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Nob3dNb2RhbCBjb21wbGV0ZScsIHJlcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuXG4gICAgfSxcblxuICAgIHNpZ246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgR2FtZVRvb2xzLnBsYXlTaW1wbGVBdWRpb0VuZ2luZSgzKTtcbiAgICAgICAgbGV0IGNvaW5zID0gWzIwMDAsIDEwMCwgNDAwMCwgMjAwLCA4MDAwLCA0MDAsIDE1MDAwXTtcblxuICAgICAgICBpZiAodGhpcy5oYXNDaGVja2VkVG9kYXkoKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCLlt7Lnu4/nrb7liLBcIilcbiAgICAgICAgICAgIEdhbWVUb29scy5zaG93RGlhbG9nKCflt7Lnu4/nrb7liLAnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZih0aGlzLmRheSAlIDIgIT0gMCl7XG4gICAgICAgICAgICBHYW1lQ29uZmlnLkdhbWVDb2luICs9IGNvaW5zW3RoaXMuZGF5XTtcbiAgICAgICAgICAgIEdhbWVUb29scy5zaG93VG9hc3QoXCLojrflvpflhYPlrp0rXCIgKyBjb2luc1t0aGlzLmRheV0pO1xuICAgICAgICAgICAgR2FtZVRvb2xzLnNldEl0ZW1CeUxvY2FsU3RvcmFnZShcIkdhbWVDb2luXCIsR2FtZUNvbmZpZy5HYW1lQ29pbik7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgR2FtZUNvbmZpZy5HYW1lTW9uZXkgKz0gY29pbnNbdGhpcy5kYXldO1xuICAgICAgICAgICAgR2FtZVRvb2xzLnNob3dUb2FzdChcIuiOt+W+l+mTnOmSsStcIiArIGNvaW5zW3RoaXMuZGF5XSk7XG4gICAgICAgICAgICBHYW1lVG9vbHMuc2V0SXRlbUJ5TG9jYWxTdG9yYWdlKFwiR2FtZU1vbmV5XCIsR2FtZUNvbmZpZy5HYW1lTW9uZXkpO1xuICAgICAgICB9XG5cbiAgICAgICAgd2luZG93LmNwLmRpc2FibGVCdG4odGhpcy5kYXkpOy8v5oyJ6ZKu55qE5Yik5patXG4gICAgICAgIEdhbWVUb29scy5zZXRJdGVtQnlMb2NhbFN0b3JhZ2UoXCJjaGVja0luRGF5c1wiLHRoaXMuU2lnbkRheSsxKTtcbiAgICAgICAgR2FtZVRvb2xzLnNldEl0ZW1CeUxvY2FsU3RvcmFnZShcImNoZWNrSW5UaW1lc3RhbXBcIixEYXRlLm5vdygpKTtcbiAgICAgICAgLy8gR2FtZURhdGEuc2V0U2lnbkRheShHYW1lRGF0YS5nZXRTaWduRGF5KCkrMSk7XG4gICAgICAgIC8vIEdhbWVEYXRhLnNldENoZWNrSW5UaW1lc3RhbXAoRGF0ZS5ub3coKSk7XG4gICAgfSxcbn0pO1xuIl19